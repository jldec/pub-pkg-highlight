<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="robots" content="noindex, nofollow">

<!-- html generated by pub-server from markdown /javascript.md -->

<title>JavaScript</title>
<link rel="stylesheet" href="./css/highlight-9.18.1-github.css">
<link rel="stylesheet" href="./css/github-markdown.css">
<link rel="stylesheet" href="./css/pub-theme-doc.css">
<link rel="stylesheet" href="./css/font-awesome.css">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>

<div data-render-layout="main-layout"><header>
<div id="doctitle"><h1 id="pub-pkg-highlight"><a href="./">pub-pkg-highlight</a></h1>
</div>
<div id="topmenu"><ul>
<li><a href="https://github.com/jldec/pub-pkg-highlight" title="github" target="_blank" rel="noopener"><span class="fa fa-lg fa-fw">&#xf09b;</span></a></li>
</ul>
</div>
</header>

<div id="navicon" onclick=""><p><span class="fa fa-fw fa-lg">&#xf0c9;</span></p>

<nav id="toc">
<ul>
<li><a href="./">README</a></li>
<li><a href="./java">Java</a></li>
<li><a href="./javascript">JavaScript</a></li>
<li><a href="./markdown">Markdown</a></li>
<li><a href="./python">Python</a></li>
</ul>
</nav>
</div>

<div id="main" onclick="">
<div id="content" class="markdown-body">
<div data-render-page="default"><div data-render-html="/javascript"><h3 id="javascript">JavaScript</h3>
<pre><code class="language-js">/*
 * asyncbuilder
 * simple semi-asynchronous list builder
 * copyright 2015-2020, Jürgen Leschner - github.com/jldec - MIT license
*/

module.exports = asyncbuilder;

function asyncbuilder(mainCallBack) {

  if (!(this instanceof asyncbuilder)) return new asyncbuilder(mainCallBack);

  // private
  var results = [];
  var pending = 0;        // number of outstanding results
  var isComplete = false; // true after complete()
  var spent = false;      // true after mainCallBack()
  var asyncErr = null;    // queued async err

  // public
  this.append = append;
  this.asyncAppend = asyncAppend;
  this.complete = complete;

  //--//--//--//--//--//--//--//--//--//

  // append result immediately (no callback required)
  function append(result) {
    if (spent) throw new Error(&#39;asyncbuilder append after mainCallBack&#39;);
    if (isComplete) {
      asyncErr = asyncErr || new Error(&#39;asyncbuilder append after complete.&#39;);
      return;
    }
    results.push(result);
  }

  // reserve a slot and return a callback(err, result) for async result
  // the callback inserts the result into the slot (or propagetes any error)
  function asyncAppend() {
    if (spent) throw new Error(&#39;asyncbuilder asyncAppend after mainCallBack&#39;);
    if (isComplete) {
      asyncErr = asyncErr || new Error(&#39;asyncbuilder asyncAppend after complete.&#39;);
      return function(){};
    }
    var slot = results.push(&#39;&#39;) - 1;
    pending++;
    return function(err, result) {
      pending--;
      asyncErr = asyncErr || err;
      results[slot] = result;
      if (isComplete &amp;&amp; !spent &amp;&amp; !pending) {
        spent = true;
        mainCallBack(asyncErr, results);
      }
    };
  }

  // call ab.complete() after the last append() or asyncAppend()
  function complete() {
    isComplete = true;
    if (!pending &amp;&amp; !spent) {
      spent = true;
      process.nextTick(function() {
        mainCallBack(asyncErr, results);
      });
    }
  }

}</code></pre>
</div>
</div>
</div>
<div id="credit"><p><span class="fa">&#xf004;</span> powered by <a href="https://jldec.github.io/pub-doc/" target="_blank" rel="noopener">pub-server</a> and <a href="https://github.com/jldec/pub-theme-doc" target="_blank" rel="noopener">pub-theme-doc</a></p>
</div>
</div>
</div>

<script>window.pubRef = {"href":"/javascript","relPath":"."};</script>
<script src="./js/jquery-1.12.4.min.js" ></script>
<script src="./js/highlight-9.18.1.min.js" ></script>
<script src="./js/pub-pkg-highlight.js" ></script>
<script src="./pub/pub-ux.js" ></script>
<!-- Copyright (c) 2015-2020 Jürgen Leschner - github.com/jldec - MIT license -->
</body>
</html>
